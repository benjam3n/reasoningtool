---
interface Props {
  activeNav?: string;
}
const { activeNav = '' } = Astro.props;

const links = [
  { href: '/skills', label: 'Skills', id: 'skills' },
  { href: '/graph', label: 'Graph', id: 'graph' },
  { href: '/viewer', label: 'Viewer', id: 'viewer' },
  { href: '/tools', label: 'Tools', id: 'tools' },
  { href: '/getting-started', label: 'Get Started', id: 'getting-started' },
  { href: '/about', label: 'About', id: 'about' },
  { href: 'https://github.com/benjam3n/reasoningtool', label: 'GitHub', id: 'github' },
];
---

<nav class="nav">
  <div class="nav__inner">
    <a href="/" class="nav__brand">reasoningtool</a>
    <ul class="nav__links">
      {links.map(link => (
        <li>
          <a
            href={link.href}
            class:list={[{ active: activeNav === link.id }]}
            {...(link.id === 'github' ? { target: '_blank', rel: 'noopener' } : {})}
          >{link.label}</a>
        </li>
      ))}
      <li>
        <button class="nav__theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
          <span id="theme-icon">&#9790;</span>
        </button>
      </li>
    </ul>
  </div>
</nav>

<script is:inline>
  (function() {
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

    function applyTheme() {
      const stored = localStorage.getItem('theme');
      if (stored) document.documentElement.setAttribute('data-theme', stored);
    }

    function updateIcon() {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark' ||
        (!document.documentElement.getAttribute('data-theme') && prefersDark);
      const icon = document.getElementById('theme-icon');
      if (icon) icon.textContent = isDark ? '\u2600' : '\u263E';
    }

    function setupToggle() {
      applyTheme();
      updateIcon();
      document.getElementById('theme-toggle')?.addEventListener('click', function() {
        const current = document.documentElement.getAttribute('data-theme');
        const isDark = current === 'dark' || (!current && prefersDark);
        const next = isDark ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
        updateIcon();
      });
    }

    document.addEventListener('DOMContentLoaded', setupToggle);
    document.addEventListener('astro:after-swap', setupToggle);
  })();
</script>
