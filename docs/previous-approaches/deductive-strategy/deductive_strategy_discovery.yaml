# Deductive Strategy Discovery Procedure
# Purpose: Derive strategies from problem axioms through logical reasoning
# Version: 1.0.0

id: deductive_strategy_discovery
name: Deductive Strategy Discovery
domain: planning
version: "1.0.0"
tags: ["deductive", "strategy", "discovery", "mandatory", "derivation"]

description: |
  Derive strategies by working backward from success criteria to required actions.

  Instead of brainstorming "what could work?" this procedure asks:
  "What MUST be done to satisfy the problem axioms?"

  The output is strategies with explicit logical derivations showing WHY
  they are necessary, not just possible.

when_to_use:
  - At the start of strategy discovery
  - When existing strategies feel like "guesses"
  - When you want strategies that feel self-evidently correct
  - When you need high confidence before committing resources

core_insight: |
  The reason most strategies feel uncertain is they're generated by association
  rather than derivation. "People with this problem often try X" is not the same
  as "Given your problem definition, X is logically required."

  Deductive discovery works backward:
  1. What does success require?
  2. What does each requirement demand?
  3. What actions satisfy those demands?

  The resulting strategy isn't one of many options - it's the logical consequence
  of the problem definition.

# ============================================
# EXECUTABLE STEPS
# ============================================

steps:
  - id: extract_axioms
    name: Extract Problem Axioms
    action: ask_llm
    description: Convert goal into formal logical premises
    prompt_template: procedures/deductive/extract_axioms
    output_mapping:
      problem_axioms: problem_axioms

  - id: derive_requirements
    name: Derive Necessary Requirements
    action: ask_llm
    description: Work backward from success to required conditions
    prompt_template: procedures/deductive/derive_requirements
    input_mapping:
      problem_axioms: problem_axioms
    output_mapping:
      requirement_chain: requirement_chain

  - id: identify_strategy_space
    name: Identify Strategy Space
    action: ask_llm
    description: Find all strategies that could satisfy requirements
    prompt_template: procedures/deductive/identify_strategies
    input_mapping:
      requirement_chain: requirement_chain
    output_mapping:
      candidate_strategies: candidate_strategies

  - id: apply_elimination
    name: Apply Elimination Reasoning
    action: ask_llm
    description: Eliminate strategies that violate constraints or fail requirements
    prompt_template: procedures/deductive/elimination
    input_mapping:
      candidate_strategies: candidate_strategies
      problem_axioms: problem_axioms
    output_mapping:
      surviving_strategies: surviving_strategies
      elimination_reasoning: elimination_reasoning

  - id: build_proofs
    name: Build Strategy Proofs
    action: ask_llm
    description: Construct deductive chains for surviving strategies
    prompt_template: procedures/deductive/build_proofs
    input_mapping:
      surviving_strategies: surviving_strategies
      problem_axioms: problem_axioms
    output_mapping:
      strategy_proofs: strategy_proofs

  - id: store_results
    name: Store Discovery Results
    action: store
    input_mapping:
      problem_axioms: problem_axioms
      strategy_proofs: strategy_proofs
      deductive_discovery_completed: true
    output_mapping:
      deductive_strategies: deductive_strategies

# ============================================
# DETAILED PROCEDURES
# ============================================

procedures:

  backward_chaining:
    description: Work backward from success criteria to required actions

    inputs:
      - success_criteria: List of conditions that define success
      - constraints: Things that cannot be violated

    process:
      1. For Each Success Criterion:
         - Ask: "What conditions must hold for this criterion to be met?"
         - For each condition: "What must be done to make this condition hold?"
         - Continue until you reach actionable steps

      2. Build Requirement Tree:
         - Root: The success criterion
         - Branches: Conditions that enable it
         - Leaves: Actions that create those conditions

      3. Identify Critical Path:
         - Which requirements have no alternatives?
         - These become NECESSARY components of strategy

      4. Check Against Constraints:
         - Does any requirement violate a constraint?
         - If yes, that path is blocked - find alternative

    output:
      requirement_tree:
        root: success_criterion
        children: [list of enabling conditions]
        leaves: [list of required actions]
        critical_path: [list of necessary elements]
        constraint_violations: [list of blocked paths]

  forward_derivation:
    description: Given problem state, derive what strategies are possible

    inputs:
      - current_state: What is true now
      - goal_state: What must be true for success
      - available_actions: What can be done

    process:
      1. Compute State Gap:
         - What conditions are true in goal but not in current?
         - These are the conditions to achieve

      2. For Each Gap:
         - Which available actions could create this condition?
         - What preconditions do those actions have?
         - Can preconditions be satisfied from current state?

      3. Build Action Graph:
         - Nodes: States and conditions
         - Edges: Actions that transform states
         - Find paths from current to goal

      4. Identify Shortest/Best Paths:
         - Fewer steps = less risk of failure
         - More reversible = safer
         - Less resource-intensive = more feasible

    output:
      derivation_result:
        gap_analysis: [conditions to achieve]
        action_graph: [nodes and edges]
        viable_paths: [paths from current to goal]
        recommended_path: [best path with reasoning]

  necessity_analysis:
    description: Determine if a strategy is necessary or just possible

    inputs:
      - strategy: The strategy to analyze
      - problem_axioms: The formalized problem

    process:
      1. Check Uniqueness:
         - Is this the ONLY strategy that satisfies all axioms?
         - If yes: NECESSARY
         - If no: SUFFICIENT at best

      2. Check Sufficiency:
         - Does this strategy definitely satisfy all success criteria?
         - If yes: SUFFICIENT
         - If uncertain: POSSIBLE

      3. Check Completeness:
         - Does strategy address all success criteria?
         - If any are missed: INSUFFICIENT

      4. Articulate Necessity:
         - If necessary: "Given [premises], this is the only option because..."
         - If sufficient: "This works because..., alternatives are..."
         - If possible: "This might work if..."

    output:
      necessity_analysis:
        is_necessary: boolean
        is_sufficient: boolean
        is_complete: boolean
        necessity_explanation: string
        alternatives_if_not_necessary: [list of alternatives]

  strategy_synthesis:
    description: Combine multiple necessary components into complete strategy

    inputs:
      - necessary_components: Things that MUST be in the strategy
      - optional_enhancements: Things that could improve the strategy
      - constraints: Things that must not be violated

    process:
      1. Order by Dependency:
         - Which components depend on others?
         - Put dependencies first

      2. Check Compatibility:
         - Do any necessary components conflict?
         - If yes: Problem is impossible as stated

      3. Add Enhancements:
         - For each optional enhancement:
           - Does it conflict with necessary components?
           - Does it violate constraints?
           - If compatible, include with justification

      4. Verify Completeness:
         - Does synthesized strategy address all success criteria?
         - Are all constraints respected?

    output:
      synthesized_strategy:
        necessary_components: [ordered list]
        included_enhancements: [list with justifications]
        excluded_enhancements: [list with reasons]
        completeness_check: boolean
        constraint_compliance: boolean

# ============================================
# INTEGRATION WITH GOSM
# ============================================

gosm_integration:

  sequence_position: |
    This procedure runs in Step 8 (Strategy Discovery), BEFORE:
    - Innovation Engine (Step 9)
    - Adversarial Review (Step 10)

    It provides logically-derived strategies that are then:
    - Expanded by innovation (find non-obvious alternatives)
    - Tested by adversarial review (verify logical soundness)

  use_cases:
    - At the beginning of strategy phase
    - When innovation produces too many "random" strategies
    - When adversarial review keeps defeating strategies (need stronger foundation)
    - When user wants high-confidence strategies

  context_keys:
    input:
      - goal: The goal being pursued
      - context: Current execution context
    output:
      - problem_axioms: Formalized problem axioms
      - strategy_proofs: Strategies with deductive chains
      - deductive_discovery_completed: boolean

  gates:
    - gate: axioms_extracted
      question: "Have problem axioms been formally extracted from the goal?"

    - gate: backward_chaining_done
      question: "Has backward chaining from success criteria been completed?"

    - gate: necessity_analyzed
      question: "Has necessity analysis been performed on candidate strategies?"

  related_procedures:
    - logical_proof_system: Foundation for logical reasoning
    - deductive_strategy_evaluation: Validate derived strategies
    - innovation_engine: Expand strategy space after derivation
    - adversarial_review: Test derived strategies adversarially

  # ============================================
  # GOAL UNDERSTANDING PIPELINE
  # ============================================
  # This procedure is STEP 4 of the goal understanding pipeline:
  #
  #   1. recursive_causal_interrogation
  #      → Question the framing, trace causes of the goal statement
  #      → Output: Clearer understanding of what's actually being sought
  #
  #   2. goal_structure_reconstruction
  #      → Trace goal chain: action → goal → goal → intrinsic goal
  #      → Output: The "story" of why this goal matters
  #
  #   3. backward_reasoning
  #      → Given conclusions, trace back to premises
  #      → Output: Understanding of what journey led here
  #
  #   4. deductive_strategy_discovery (THIS)
  #      → Derive strategies from problem structure
  #      → Output: Strategies native to the actual situation
  #
  # Use this after the goal is fully understood to derive strategies
  # that are logically required, not just brainstormed.
  goal_understanding_pipeline:
    position: 4
    previous: backward_reasoning
    when_to_use_this_step: |
      Use after backward reasoning when:
      - Goal and journey are understood
      - Ready to derive what strategies are actually required
      - Want strategies with logical backing, not guesses
      - Previous brainstormed strategies felt arbitrary

# ============================================
# QUALITY
# ============================================

verification:
  - All success criteria are traced to required actions
  - Constraints are checked against all strategies
  - Necessity vs sufficiency is explicitly stated
  - Critical assumptions are identified
  - At least one strategy has proof strength of SUFFICIENT or higher

failure_modes:
  - mode: Incomplete axiom extraction
    symptom: Derived strategies miss important considerations
    resolution: Use thorough goal analysis (v6-style) before extraction

  - mode: False necessity claims
    symptom: Strategy claimed necessary but alternatives exist
    resolution: Explicitly enumerate and eliminate alternatives

  - mode: Over-constrained problem
    symptom: No strategy satisfies all axioms
    resolution: Re-examine constraints, some may be preferences not requirements

  - mode: Circular reasoning
    symptom: Strategy justifies itself rather than deriving from axioms
    resolution: Check that all premises are independent of conclusion

# ============================================
# EXAMPLES
# ============================================

examples:
  - name: Deriving strategy for chronic health improvement
    context: |
      User has been trying supplements and health influencer advice for years
      without seeing results. Wants strategies that actually work.

    problem_axioms:
      success_requirements:
        - "Breathing through nose is comfortable"
        - "Resting heart rate is in healthy range"
        - "Weight is in healthy range"
        - "Can exercise without excessive breathlessness"

      constraints:
        - "Limited budget for expensive interventions"
        - "Must fit into existing schedule"
        - "Must not cause harmful side effects"

      past_failures:
        - "Multiple supplements tried without noticeable effect"
        - "Health influencer advice was hit-or-miss"

    backward_chaining:
      from: "Breathing through nose is comfortable"
      requires:
        - "Nasal passages are not obstructed"
        - "No chronic inflammation in nasal passages"
      which_requires:
        - "Medical evaluation to identify obstruction cause"
        - "Address identified cause specifically"
      conclusion: |
        MUST: Get medical evaluation for nasal breathing issues
        REASON: Cannot address root cause without knowing it

    derived_strategy:
      necessary_components:
        - component: "Medical evaluation for breathing issues"
          necessity: "Cannot treat without diagnosis"
          derivation: "Breathing problem -> unknown cause -> must identify cause"

        - component: "Address diagnosed cause specifically"
          necessity: "Generic approaches failed; specific required"
          derivation: "Past failures with generic -> specific needed"

      proof_strength: sufficient
      necessity_explanation: |
        Given that:
        1. Breathing is a problem
        2. Generic approaches (supplements, influencer advice) failed
        3. Root cause is unknown

        Therefore:
        1. Must identify root cause (medical evaluation)
        2. Must address identified cause specifically
        3. Cannot skip to treatment without diagnosis

        This is NECESSARY because: you cannot effectively treat an
        unknown problem, and generic approaches have already failed.

  - name: Deriving strategy for social skill improvement
    context: |
      User feels conversations are unnatural compared to others.
      Has tried social skills books without lasting improvement.

    problem_axioms:
      success_requirements:
        - "Conversations feel natural"
        - "Can sustain longer conversations"
        - "Responses come automatically rather than calculated"

      observations:
        - "Writing/analysis is strong, speaking is weak"
        - "Others seem to have automatic social behavior I lack"
        - "Book knowledge doesn't translate to automatic behavior"

      domain_knowledge:
        - "Skill automaticity requires practice, not just knowledge"
        - "Social skills are procedural (how) not declarative (what)"
        - "Procedural skills require repetition in context"

    derived_strategy:
      necessary_components:
        - component: "Practice in real social contexts"
          necessity: "Automaticity requires practice, not study"
          derivation: |
            Goal: automatic social behavior
            Automaticity requires practice (domain knowledge)
            Therefore: practice is necessary

        - component: "Increase practice volume/frequency"
          necessity: "Current practice insufficient for automaticity"
          derivation: |
            Current state: not automatic
            Automaticity requires sufficient practice
            Current practice < sufficient practice
            Therefore: must increase practice

      proof_strength: sufficient
      necessity_explanation: |
        Given that:
        1. Goal is automatic social behavior
        2. Automaticity is achieved through practice (domain knowledge)
        3. Reading books is not practice
        4. Current practice level hasn't achieved automaticity

        Therefore:
        1. Must practice in real contexts (not just read)
        2. Must practice more than currently

        This is SUFFICIENT because: automaticity mechanisms are well-established
        in skill acquisition literature. This addresses the actual mechanism.

        Note: Specific practice methods are OPTIONAL (can vary), but
        practice itself is NECESSARY.
